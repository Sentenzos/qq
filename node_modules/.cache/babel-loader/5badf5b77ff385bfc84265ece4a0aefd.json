{"ast":null,"code":"import React,{useEffect,useMemo,useRef}from\"react\";import getDate from\"../../../common/JS/getDate\";import cn from\"classnames\";import{NavLink}from\"react-router-dom\";import DeleteMessageBtn from\"../../../common/components/DeleteMessageBtn\";import linkParser from\"../../../common/JS/linkParser\";import replaceHtmlSymbols from\"../../../common/JS/replaceHtmlSymbols\";var Message=React.memo(function(props){var avatarLink=props.senderId===props.myId?props.myAvatar:props.contactAvatar;var avatarElem=useRef(null);var deleteMessageBtn=React.createElement(DeleteMessageBtn,{className:\"message__delete-btn\",disabled:props.deletingMessages.find(function(id){return id===props.messageId;}),eventHandler:function eventHandler(){return props.deleteMessage(props.messageId);}});//Когда сервер получает текст он превращает все символы (скобки, пробелы) в html коды.\n//Необходимо преобразование обратно в символы для корректной работы.\nvar messageText=useMemo(function(){return linkParser(replaceHtmlSymbols(props.messageText),{width:410,height:230.625});},[props.messageText]);useEffect(function(){if(!avatarLink)return;if(!avatarElem.current)return;avatarElem.current.style.backgroundImage=\"url(\".concat(avatarLink,\")\");});//задержка между сообщениями составляет больше минуты и разные отправители\nif(!props.messageDelay||props.messageDelay>60e3||props.senderId!==props.prevSenderId){return React.createElement(\"div\",{className:cn(\"message-wrapper\",!props.viewed&&\"message-is-unread\")},deleteMessageBtn,React.createElement(\"div\",{className:\"message\"},React.createElement(NavLink,{to:\"/profile/\".concat(props.senderId)},React.createElement(\"div\",{className:\"message__avatar\",ref:avatarElem})),React.createElement(\"div\",{className:\"message__body\"},React.createElement(\"div\",{className:\"message__info\"},React.createElement(\"h1\",{className:\"message__from\"},props.senderName),React.createElement(\"time\",{className:\"message__time\"},getDate(props.messageDate).getTime),React.createElement(\"span\",{className:\"message__date\"},getDate(props.messageDate).getFullDate)),React.createElement(\"p\",{className:\"message__text\",dangerouslySetInnerHTML:{__html:messageText}}))));}else if(props.messageDelay<60e3){return React.createElement(\"div\",{className:cn(\"additional-text__wrapper\",!props.viewed&&\"message-is-unread\")},deleteMessageBtn,React.createElement(\"p\",{className:\"messages__additional-text\",dangerouslySetInnerHTML:{__html:messageText}}));}});export default Message;","map":{"version":3,"sources":["D:/my-own-social-network/src/components/Dialogs/ChatWall/Message.jsx"],"names":["React","useEffect","useMemo","useRef","getDate","cn","NavLink","DeleteMessageBtn","linkParser","replaceHtmlSymbols","Message","memo","props","avatarLink","senderId","myId","myAvatar","contactAvatar","avatarElem","deleteMessageBtn","deletingMessages","find","id","messageId","deleteMessage","messageText","width","height","current","style","backgroundImage","messageDelay","prevSenderId","viewed","senderName","messageDate","getTime","getFullDate","__html"],"mappings":"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","sourcesContent":["import React, {useEffect, useMemo, useRef} from \"react\";\r\nimport getDate from \"../../../common/JS/getDate\";\r\nimport cn from \"classnames\";\r\nimport {NavLink} from \"react-router-dom\";\r\nimport DeleteMessageBtn from \"../../../common/components/DeleteMessageBtn\";\r\nimport linkParser from \"../../../common/JS/linkParser\";\r\nimport replaceHtmlSymbols from \"../../../common/JS/replaceHtmlSymbols\";\r\n\r\n\r\nconst Message = React.memo(\r\n  (props) => {\r\n    const avatarLink = props.senderId === props.myId ? props.myAvatar : props.contactAvatar;\r\n    const avatarElem = useRef(null);\r\n    const deleteMessageBtn = <DeleteMessageBtn\r\n      className=\"message__delete-btn\"\r\n      disabled={props.deletingMessages.find(id => id === props.messageId)}\r\n      eventHandler={() => props.deleteMessage(props.messageId)}/>;\r\n\r\n    //Когда сервер получает текст он превращает все символы (скобки, пробелы) в html коды.\r\n    //Необходимо преобразование обратно в символы для корректной работы.\r\n    const messageText = useMemo(() => {\r\n      return linkParser(\r\n        replaceHtmlSymbols(props.messageText),\r\n        {width: 410, height: 230.625});\r\n    }, [props.messageText]);\r\n\r\n    useEffect(() => {\r\n      if (!avatarLink) return;\r\n      if (!avatarElem.current) return;\r\n      avatarElem.current.style.backgroundImage = `url(${avatarLink})`\r\n    });\r\n\r\n    //задержка между сообщениями составляет больше минуты и разные отправители\r\n    if (!props.messageDelay || props.messageDelay > 60e3 || props.senderId !== props.prevSenderId) {\r\n      return (\r\n        <div className={cn(\"message-wrapper\", !props.viewed && \"message-is-unread\")}>\r\n          {deleteMessageBtn}\r\n          <div className=\"message\">\r\n            <NavLink to={`/profile/${props.senderId}`}>\r\n              <div className=\"message__avatar\" ref={avatarElem}/>\r\n            </NavLink>\r\n            <div className=\"message__body\">\r\n              <div className=\"message__info\">\r\n                <h1 className=\"message__from\">{props.senderName}</h1>\r\n                <time className=\"message__time\">{getDate(props.messageDate).getTime}</time>\r\n                <span className=\"message__date\">{getDate(props.messageDate).getFullDate}</span>\r\n              </div>\r\n              <p className=\"message__text\" dangerouslySetInnerHTML={{__html: messageText}}/>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )\r\n    } else if (props.messageDelay < 60e3) {\r\n      return (\r\n        <div className={cn(\"additional-text__wrapper\", !props.viewed && \"message-is-unread\")}>\r\n          {deleteMessageBtn}\r\n          <p className=\"messages__additional-text\" dangerouslySetInnerHTML={{__html: messageText}}/>\r\n        </div>\r\n      )\r\n    }\r\n  }\r\n);\r\n\r\n\r\nexport default Message;"]},"metadata":{},"sourceType":"module"}